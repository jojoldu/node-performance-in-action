# Promise.all & Transactions (feat. Node.js)

## 테스트 환경

* Node.js 16.3.1
* PostgreSQL 13.2

## 마무리

* `Promise.all()` 을 사용하고 실패한다고 해서 아직 끝나지 않은 Promise가 강제 종료되진 않는다.
  * 단지 결과를 무시할 뿐이기 때문에 수행할 것들은 수행된다.
* `Promise.allSettled()` 를 사용하면 전체의 결과를 다 수집할때까지 기다린다. 
* 트랜잭션 Commit / Rollback을 위해서는 단일 커넥션 안에서 이루어져야 한다.
* 단일 커넥션을 사용한다면, 커넥션을 사용할 때까지 대기를 해야되기 때문에 Promise.all(allSettled)를 사용한다하더라도 비동기로 작업을 처리할 수가 없다.
* 트랜잭션으로 단일 커넥션만 사용하는 경우 `Promise.all()` (`Promise.allSettled()`) 보다 오히려 `for` 가 더 나을 수 있다.
  * 단일 커넥션만 사용하는 경우 어차피 **비동기 실행이 안된다**
  * 이미 앞에서 실패해서 더이상 실행하지 않아도 되는 경우에도 쿼리들이 수행된다.
    * 어차피 롤백해야되는 쿼리들이다.
  * `for` 로 실패하면 다음 쿼리들이 실행조차 안되도록 하는 것이 낫다. 
